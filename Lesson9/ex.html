<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>[Bài tập] Game puzzle - 5x1 Grid</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f4f4f4;
        color: #333;
      }
      .container {
        background-color: #fff;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        max-width: fit-content; /* Điều chỉnh để phù hợp với lưới */
        margin: auto;
        text-align: center;
      }
      h1,
      h2,
      h3 {
        color: #0056b3;
      }
      .puzzle-grid {
        display: grid;
        grid-template-columns: 1fr; /* 1 cột */
        grid-template-rows: repeat(5, 1fr); /* 5 hàng */
        gap: 5px; /* Khoảng cách giữa các ô */
        width: 102px; /* 100px + 2px border */
        height: 530px; /* 100px * 5 + 5px * 4 = 520px (thêm 10px để tính cả border ngoài cùng nếu có) */
        margin: 20px auto;
        border: 2px solid #ccc;
      }
      .puzzle-cell {
        width: 100px;
        height: 100px;
        border: 1px solid #eee;
        cursor: pointer;
        overflow: hidden; /* Đảm bảo ảnh không tràn ra ngoài ô */
      }
      .puzzle-cell img {
        width: 100%;
        height: 100%;
        display: block; /* Loại bỏ khoảng trống dưới ảnh */
        object-fit: cover; /* Đảm bảo ảnh cover toàn bộ ô */
      }
      #message {
        margin-top: 20px;
        font-size: 1.5em;
        font-weight: bold;
        color: #28a745;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>[Bài tập] Game puzzle</h1>

      <div class="puzzle-grid" id="puzzleGrid"></div>

      <p id="message"></p>
    </div>

    <script>
      // Mảng 2 chiều chứa các đường dẫn ảnh cho từng ô.
      // Cần 5 phần tử con cho 5 ô.
      // Mỗi phần tử con là một mảng các ảnh có thể xuất hiện trong ô đó.
      // Giả sử ảnh hoàn chỉnh là 5 mảnh (từ 1 đến 5) được xếp dọc.
      // Bạn cần thay thế bằng đường dẫn ảnh thật của mình.
      const imageSetsForCells = [
        // Ô 0 (vị trí đúng là puzzle_part_1)
        [
          "/Lesson9/Image/imgTrue/1.jpg",
          "Lesson9/Image/random_12.jpg",
          "Lesson9/Image/random_5.jpg",
          "Lesson9/Image/random_7.jpg",
        ],
        // Ô 1 (vị trí đúng là puzzle_part_2)
        [
          "/Lesson9/Image/imgTrue/2.jpg",
          "Lesson9/Image/random_13.jpg",
          "Lesson9/Image/random_2.jpg",
          "Lesson9/Image/random_14.jpg",
        ],
        // Ô 2 (vị trí đúng là puzzle_part_3)
        [
          "/Lesson9/Image/imgTrue/3.jpg",
          "Lesson9/Image/random_8.jpg",
          "Lesson9/Image/random_6.jpg",
          "Lesson9/Image/random_11.jpg",
        ],
        // Ô 3 (vị trí đúng là puzzle_part_4)
        [
          "/Lesson9/Image/imgTrue/4.jpg",
          "Lesson9/Image/random_15.jpg",
          "Lesson9/Image/random_9.jpg",
          "Lesson9/Image/random_10.jpg",
        ],
        // Ô 4 (vị trí đúng là puzzle_part_5)
        [
          "/Lesson9/Image/imgTrue/5.jpg",
          "Lesson9/Image/random_3.jpg",
          "Lesson9/Image/random_1.jpg",
          "Lesson9/Image/random_4.jpg",
        ],
      ];

      // Biến để lưu trữ chỉ mục của ảnh HIỆN TẠI đang hiển thị trong MẢNG NỘI BỘ của mỗi ô
      let currentDisplayIndexes = [];

      const totalCells = 5; // Tổng số ô là 5 (5 hàng x 1 cột)

      // Hàm khởi tạo game
      function initializePuzzle() {
        const puzzleGrid = document.getElementById("puzzleGrid");
        puzzleGrid.innerHTML = "";

        currentDisplayIndexes = [];

        for (let i = 0; i < totalCells; i++) {
          const cell = document.createElement("div");
          cell.classList.add("puzzle-cell");
          cell.dataset.cellIndex = i;

          // Khởi tạo mỗi ô với một ảnh ngẫu nhiên từ bộ ảnh của nó
          const initialImageInsideCellIndex = Math.floor(
            Math.random() * imageSetsForCells[i].length
          );

          currentDisplayIndexes.push(initialImageInsideCellIndex);

          const img = document.createElement("img");
          img.src = imageSetsForCells[i][initialImageInsideCellIndex];
          cell.appendChild(img);

          cell.addEventListener("click", handleCellClick);
          puzzleGrid.appendChild(cell);
        }
        document.getElementById("message").textContent = "";
      }

      // Hàm xử lý khi một ô được click
      function handleCellClick(event) {
        const clickedCell = event.currentTarget;
        const cellIndex = parseInt(clickedCell.dataset.cellIndex);

        let currentImageInsideCellIndex = currentDisplayIndexes[cellIndex];

        // Tăng chỉ mục lên 1, nếu vượt quá số lượng ảnh trong bộ ảnh của ô đó thì quay về 0
        currentImageInsideCellIndex =
          (currentImageInsideCellIndex + 1) %
          imageSetsForCells[cellIndex].length;

        currentDisplayIndexes[cellIndex] = currentImageInsideCellIndex;
        clickedCell.querySelector("img").src =
          imageSetsForCells[cellIndex][currentImageInsideCellIndex];

        checkPuzzleCompletion();
      }

      // Hàm kiểm tra xem tất cả các ô đã đúng vị trí chưa
      function checkPuzzleCompletion() {
        let isCompleted = true;
        for (let i = 0; i < totalCells; i++) {
          // Điều kiện hoàn thành: ảnh tại ô 'i' phải là ảnh ĐẦU TIÊN (chỉ mục 0) trong bộ ảnh của ô đó.
          if (currentDisplayIndexes[i] !== 0) {
            isCompleted = false;
            break;
          }
        }

        if (isCompleted) {
          document.getElementById("message").textContent =
            "Chúc mừng! Bạn đã hoàn thành bức tranh!";
        } else {
          document.getElementById("message").textContent = "";
        }
      }

      // Khởi tạo game khi trang web được tải
      document.addEventListener("DOMContentLoaded", initializePuzzle);
    </script>
  </body>
</html>
